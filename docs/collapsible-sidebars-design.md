# 可关闭侧栏设计文档

## 目标与范围

- **左侧栏**：Session History（New Session、会话列表）。
- **右侧栏**：Images（图片列表、Select、Generate PPT 等）。
- 两者均支持**用户手动关闭 / 再打开**，且在不同端（PC、平板、手机）下有**统一、美观、易用**的交互。

---

## 一、响应式与断点策略

### 1.1 断点约定（与现有 Tailwind 一致）

| 断点 | 宽度 | 用途 |
|------|------|------|
| 默认 | &lt; 768px | 手机 |
| `md` | ≥ 768px | 平板竖屏 / 大手机 |
| `lg` | ≥ 1024px | 平板横屏 / 小笔记本 |
| `xl` | ≥ 1280px | 桌面 |

### 1.2 各端默认与可选行为

| 端 | 左侧栏 | 右侧栏 | 说明 |
|----|--------|--------|------|
| **手机** (&lt; md) | 抽屉，默认收起 | 抽屉，默认收起 | 不占主区域，按需从侧边滑出 |
| **平板** (md ~ lg) | 可侧栏或抽屉 | 抽屉，默认收起 | 左栏优先侧栏以保核心流程；右栏省空间 |
| **桌面** (≥ lg) | 侧栏，默认展开 | 侧栏，默认展开 | 与当前一致；支持关闭以放大聊天区 |

- **侧栏**：固定宽（如 `w-64`），与主区域并列，可关闭后变成窄条或隐藏。
- **抽屉**：覆盖或半覆盖主区域，从左/右滑入，带遮罩；关闭后不占布局宽度。

---

## 二、桌面端（≥ lg）设计

### 2.1 展开态

- 左、右侧栏均可见，宽度 `w-64`（256px），与现有一致。
- 主聊天区 `flex-1` 自适应中间宽度。

### 2.2 折叠态（用户点击关闭后）

- **不采用「完全消失」**：侧栏收起后，在贴近主区域的一侧保留一条**窄竖条**（如宽 40px），用于：
  - 展示一个**展开**图标（如 `PanelLeft` / `PanelRight` 或 `ChevronRight` / `ChevronLeft`）；
  - 点击即可重新打开对应侧栏。
- 竖条视觉：
  - 与 `card` / `border` 同色系，弱对比；
  - 可带轻微圆角（仅靠主区域一侧），与整体风格一致；
  - Hover 时略有高亮（如 `bg-muted` 或 `border-primary/30`），提示可点击。

### 2.3 折叠 / 展开触发位置

- **在侧栏内部**：顶部靠主区域一侧放折叠按钮（如 `PanelLeftClose`），仅侧栏展开时显示。
- **在窄竖条上**：仅侧栏收起时显示，放展开按钮。
- 桌面端**不强制**在 top bar 增加 Sessions / Images 开关，以保持顶栏简洁；若后续需要可再加。

### 2.4 动画

- 侧栏展开 / 收起：`width` 或 `max-width` 过渡（如 200–250ms `ease-in-out`），避免突变。
- 窄竖条出现 / 消失：可与侧栏共用同一过渡，或淡入淡出（`opacity`），时长略短亦可。

---

## 三、平板端（md ~ lg）设计

### 3.1 左侧栏（Session History）

- **默认**：以侧栏形式显示（与现有 `md:flex` 一致），支持折叠。
- **折叠后**：同样保留窄竖条 + 展开按钮，行为同桌面端。

### 3.2 右侧栏（Images）

- **默认**：收起（抽屉），不占横向空间，主区域更大。
- **打开方式**：在 top bar 或主区域合适位置提供 **「Images」入口**（图标 + 文案可选），点击后从右侧滑出**抽屉**。
- 抽屉：可全高、宽约 `min(360px, 90vw)`，带遮罩；点击遮罩或抽屉内关闭按钮即关闭。

### 3.3 窄竖条

- 仅左侧栏折叠时显示左竖条；右侧栏在平板端以抽屉为主，不做固定窄竖条亦可，或做一条较细的「Images」标签竖条，点击滑出抽屉。

---

## 四、手机端（&lt; md）设计

### 4.1 侧栏不占位

- 左、右都不以固定侧栏形式占主区域，主区域全宽给聊天。

### 4.2 左侧栏（Sessions）

- **入口**：在 top bar 或聊天区上方提供 **「Sessions」 / 会话图标**（如 `LayoutList` 或菜单图标）。
- **呈现**：点击后从**左侧滑出抽屉**，全高，宽约 `min(280px, 85vw)`，带遮罩。
- 抽屉内：New Session、Session History 等与现有一致，底部可放关闭按钮。

### 4.3 右侧栏（Images）

- **入口**：**「Images」 / 图片图标**，可与 Sessions 对称摆放。
- **呈现**：点击后从**右侧滑出抽屉**，规格同左（全高，`min(280px, 85vw)`），带遮罩。

### 4.4 抽屉统一规范

- 滑入 / 滑出：`transform: translateX` 动画，约 250ms `ease-out`。
- 遮罩：半透明黑（如 `bg-black/50`），点击关闭抽屉。
- 可选：抽屉内顶部有明确的关闭按钮（X），避免误触。

---

## 五、状态模型与持久化

### 5.1 状态

- `leftSidebarOpen`：布尔，桌面/平板侧栏模式下左侧栏是否展开。
- `rightSidebarOpen`：布尔，桌面/平板侧栏模式下右侧栏是否展开。
- `leftDrawerOpen`：布尔，手机/平板抽屉模式下左侧抽屉是否打开。
- `rightDrawerOpen`：布尔，手机/平板抽屉模式下右侧抽屉是否打开。

（若左右均不采用抽屉，则可省略 `*DrawerOpen`；若有则与 `*SidebarOpen` 分离，便于按端切换逻辑。）

### 5.2 持久化（可选）

- 将 `leftSidebarOpen`、`rightSidebarOpen` 存入 `localStorage`（如 `chatbot-sidebars`）。
- 仅持久化**侧栏**开关状态；抽屉一般为临时打开，不持久化。
- 刷新、重新打开页面后，先读 `localStorage`，再应用默认值。

### 5.3 默认值

- 桌面 / 平板侧栏：`leftSidebarOpen: true`，`rightSidebarOpen: true`（与现有行为一致）。
- 抽屉：`leftDrawerOpen: false`，`rightDrawerOpen: false`。

---

## 六、视觉与无障碍

### 6.1 图标

- 折叠：`PanelLeftClose` / `PanelRightClose` 或 `ChevronLeft` / `ChevronRight`（与折叠方向一致）。
- 展开：`PanelLeft` / `PanelRight` 或 `ChevronRight` / `ChevronLeft`。
- 入口（手机/平板）：`LayoutList`（Sessions）、`Image` 或 `Images`（Images）。

### 6.2 无障碍

- 所有折叠/展开、抽屉开关均为 `<button>` 或可聚焦元素，带 `aria-label`（如「收起会话列表」「打开图片列表」）。
- 抽屉打开时：`aria-modal="true"`，焦点移入抽屉；关闭时焦点回到触发按钮。
- 遮罩可设 `aria-hidden="true"`，避免被读屏当内容串读。

### 6.3 主题

- 窄竖条、抽屉背景、按钮等沿用现有 `card`、`border`、`primary` 等 CSS 变量，保证亮/暗主题一致。

---

## 七、边界情况

- **折叠后刷新**：若已持久化，按存储状态恢复；否则按上文默认值。
- **从宽屏收窄到窄屏**：若侧栏展开，可自动切换为抽屉逻辑，并在进入窄屏时关闭抽屉（或提示用户），避免布局错乱。
- **同时关闭两侧**：桌面端允许，主区域全宽；必要时在窄竖条上保留最小点击热区，避免误触困难。

---

## 八、实现顺序建议（仅规划，不落地代码）

1. **状态与持久化**：定义 `leftSidebarOpen`、`rightSidebarOpen`（及可选 `*DrawerOpen`），接 `localStorage`。
2. **桌面端**：侧栏条件渲染 + 折叠/展开 + 窄竖条 + 基础过渡动画。
3. **平板端**：左侧同桌面；右侧抽屉 + Images 入口。
4. **手机端**：双抽屉 + Sessions / Images 入口，遮罩与焦点管理。
5. **响应式衔接**：断点切换时状态重置或映射，避免半个侧栏、半个抽屉的中间态。
6. **无障碍与主题**：补全 `aria-*`、焦点、键盘逻辑，核查亮/暗主题。

---

## 九、小结

| 端 | 左 | 右 | 折叠/打开方式 |
|----|----|----|----------------|
| 桌面 (≥ lg) | 侧栏，可关 → 窄竖条 | 侧栏，可关 → 窄竖条 | 栏内折叠钮 + 竖条展开钮 |
| 平板 (md~lg) | 侧栏，同桌面 | 抽屉，默认关 | 左同桌面；右由 Images 入口打开 |
| 手机 (&lt; md) | 抽屉，默认关 | 抽屉，默认关 | Sessions / Images 入口打开 |

- 侧栏关闭后**不直接消失**，用**窄竖条 + 展开**维持可发现性。
- 小屏**一律用抽屉**，不占主区域，主区域全宽给聊天。
- 状态可持久化，动画与主题与现有一致，并做好无障碍。

此文档为设计与实现规划；**已按上述方案完成实现**，参见 `components/chatbot-panel.tsx` 与 `lib/hooks/use-media-query.ts`。

---

## 实现说明（已落地）

- **状态与持久化**：`leftSidebarOpen`、`rightSidebarOpen` 存 `localStorage`（`chatbot-sidebars`）；`leftDrawerOpen`、`rightDrawerOpen` 仅内存。
- **桌面 (≥ lg)**：左/右侧栏可折叠，折叠后显示窄竖条（40px）+ `PanelLeftOpen` / `PanelRightOpen` 展开；侧栏内 `PanelLeftClose` / `PanelRightClose` 折叠。
- **平板 (md~lg)**：左侧同桌面；右侧仅抽屉，top bar 有「Images」入口。
- **手机 (< md)**：左右均抽屉；top bar 有 Sessions（`LayoutList`）、Images（`Images`）图标入口。
- **抽屉**：Sessions 抽屉宽 `min(280px,85vw)`，Images 抽屉 `min(360px,90vw)`；遮罩点击关闭，顶部有关闭按钮；`animate-in slide-in-from-*-5`。
- **断点**：`useBreakpoints()`（`useMediaQuery`）检测 `md` / `lg`。

**窗口缩放修复**：左/右竖条在「对应侧栏未展示」时**始终显示**（不再仅 md/lg）。桌面端点击竖条展开侧栏；平板/手机端点击竖条打开抽屉。这样缩放后两侧始终有可点击入口，避免侧栏消失且无法找回。
